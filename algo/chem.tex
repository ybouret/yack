\documentclass[aps,12pt]{revtex4}
\usepackage[a4paper]{geometry}
\usepackage{graphicx}
\usepackage{amssymb,amsfonts,amsmath,amsthm}
\usepackage{bm}
\usepackage{pslatex}
\usepackage{mathptmx}
\usepackage{bookman}
\usepackage{chemarr}
\usepackage{tikz}

\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
            \node[shape=circle,draw,inner sep=2pt] (char) {#1};}}
 	 
\begin{document}
\section{Notation}

\subsection{Species}
Let $A_1,\dots,A_M$ be $M$ species composing a chemical system
with their respective concentrations $[A_1],\ldots,[A_M]$.
We define a phase state vector:
\begin{equation}
	\vec{C} = 
	\begin{bmatrix}
	[A_1]\\
	\vdots\\
	[A_M]\\
	\end{bmatrix}
	\in \mathbb{R}^M
\end{equation}

\subsection{Equilibrium}
\subsection{Definition}
Let $E_i$ be an equilibrium defined with integer coefficient $\nu_{i,j}$:
\begin{equation}
	(E_i) :  \sum_{j=1}^M \nu_{i,j} A_j = 0
\end{equation}
We define the positive constant of $(E_i)$ as $K_i$ and the
equilibrium condition is described by $\Gamma_i$ and the partition
of the coefficients:
\begin{equation}
	\Gamma_i(\vec{C}) = K_i \prod_{j=1}^{M} [A_j]^{\nu^r_{ij}} 
	- \prod_{j=1}^{M} [A_j]^{\nu^p_{ij}} = 0
\end{equation}
We define:
\begin{equation}
	\vec{\bm{\nu}}^t_i = 
	\begin{bmatrix}
	\nu_{i,1}\\
	\vdots\\
	\nu_{i,M}\\
	\end{bmatrix}
\end{equation}

\subsection{Gradient}

We express the derivative of a product w.r.t. one term:
\begin{equation}
	\partial_{A_k} \left( \prod_{j=1}^{M} [A_j]^{\nu_{j}} \right)  =
	\nu_k [A_k]^{\nu_k-1} \left( \prod_{j=1,j\not=k}^{M} [A_j]^{\nu_{j}} \right)
\end{equation}
 
\begin{equation}
	\vec{\Psi}_i = \partial_{\vec{C}} \Gamma_i
\end{equation}


\subsection{Equilibria}
Let $\mathcal{E}$ be a set of $N$ independent equilibria $(E_1),\dots,(E_N)$.
We define the equilibrium vector:
\begin{equation}
	\vec{\Gamma}(\vec{C}) =
	\begin{bmatrix}
	\Gamma_1(\vec{C})\\
	\vdots\\
	\Gamma_N(\vec{C})\\
	\end{bmatrix}
	\in \mathbb{R}^N
\end{equation}

We define the topology matrix:
\begin{equation}
	\bm{\nu} = 
	\begin{bmatrix}
	\vec{\nu}_1\\
	\vdots\\
	\vec{\nu}_N\\
	\end{bmatrix}
	\in \mathbb{M}_{N,M}
	= \lbrack \nu_{i,j} \rbrack
\end{equation}


We define the Jacobian matrix:
\begin{equation}
\bm{\Psi} = \partial_{\vec{C}} \vec{\Gamma} = 
\begin{bmatrix}
	\vec{\Psi}_1\\
	\vdots\\
	\vec{\Psi}_N\\
	\end{bmatrix}
	\in \mathbb{M}_{N,M} = 
	\lbrack \partial_{A_j}\Gamma_i \rbrack
\end{equation}

\section{Balancing}

Let $b(C)$ be a function which is minimal when $C$ is positive, and increasingly positive otherwise.
For a concentration:
\begin{equation}
C_j = C_j^0 + \vec{\bm{\nu}^t_j} \cdot \vec{\xi} \Rightarrow \partial_{\xi_k} b(C_j) = \nu_{kj} b'(C_j)
\end{equation}

We define the balance vector:
\begin{equation}
\vec{B}(\vec{C}) = 
\begin{bmatrix}
	b(C_1) \\
	\vdots\\
	b(C_M)\\
\end{bmatrix}
\end{equation}
and its pseudo derivative:
\begin{equation}
\vec{B'}(\vec{C}) = 
\begin{bmatrix}
	b'(C_1) \\
	\vdots\\
	b'(C_M)\\
\end{bmatrix},
\;\;\vec{\beta} = - \vec{B'}(\vec{C})
\end{equation} 

so that:
\begin{equation}
	\partial_{\xi_k} \vec{B} = \bm{\Delta}[\bm{\nu}_k] \vec{B'}
\end{equation}

We define the total balance as:
\begin{equation}
	\mathsf{B}(\vec{C}) = \sum_j b(C_j)
\end{equation}

The descent direction is:
\begin{equation}
	-\vec{\nabla} \mathsf{B} = \bm{\nu} \vec{\beta}
\end{equation}

so that
\begin{equation}
	\vec{\xi}  =  \Delta[\vec{\alpha}] \bm{\nu} \vec{\beta},\;\;\vec{\alpha} \in \mathbb{R}_+^N
\end{equation}
which ensures
\begin{equation}
	\vec{\xi} \cdot \vec{\nabla} \mathsf{B} = - \langle \bm{\nu} \vec{\beta} \vert \Delta[\vec{\alpha}]  \vert \bm{\nu} \vec{\beta} \rangle \leq 0 
\end{equation}

\begin{equation}
	\delta\vec{C} = \bm{\nu}^t \Delta[\vec{\alpha}] \bm{\nu} \vec{\beta}
\end{equation}

\begin{equation}
	\delta\vec{C} = \bm{\nu}^t \Delta[\bm{\nu} \vec{\beta}] \vec{\alpha}
\end{equation}


\section{Solving ONE Equilibrium}

\subsection{Equation}
Let us take $\Gamma_i$.
Then there exist a unique $\xi_i^\star$ for which:
\begin{equation}
\left\lbrace
\begin{array}{rcl}
	\Gamma_i(\vec{C} + \xi_i^\star \vec{\nu}_i ) & = & 0\\
	 \xi_i^\star \times \Gamma_i(\vec{C}) &\geq  &0\\
\end{array}
\right.
\end{equation}
 
Indeed, $\xi_i^\star$ is solution of:
\begin{equation}
	 F_i(\vec{C},X) =  K_i \prod_{j=1}^{M} \left([A_j] - X \nu^r_{ij}\right)^{\nu^r_{ij}} 
	- \prod_{j=1}^{M} \left([A_j] + X \nu^p_{ij} \right)^{\nu^p_{ij}} = 0
\end{equation} 

And each $\xi_i^\star$ respects all the limiting extents.

\subsection{Where to look for}
Let us set:
\begin{equation}
\left\lbrace
\begin{array}{rcll}
	P_i(\vec{C},X) & = & \displaystyle \prod_{j=1}^{M} \left([A_j] + X \nu^p_{ij} \right)^{\nu^p_{ij}}, & \partial_X P_i(\vec{C},X) \geq 0 \\
	\\
	R_i(\vec{C},X) & = & \displaystyle K_i \prod_{j=1}^{M} \left([A_j] - X \nu^r_{ij}\right)^{\nu^r_{ij}}, & \partial_X R_i(\vec{C},X) \leq 0 \\
	\\
	 F_i(\vec{C},X) & = & R_i(\vec{C},X)  - P_i(\vec{C},X), & \partial_X F_i(\vec{C},X) < 0\\
\end{array}
\right.
\end{equation}

Let
\begin{equation}
	s_i = \mathrm{sign}\lbrack F_i(\vec{C},0) \rbrack
\end{equation}

\begin{itemize}
\item If $s_i=0$ then $X=0$ is solution at $\vec{C}$...

\item If $s_i>0$, then we look for $X>0$

\item If $s_i<0$, then we look for $X<0$

\end{itemize}

\subsection{Looking for $X\not=0$}
	
\subsubsection{Limited by BOTH}

\begin{itemize}
\item Looking for $X<0$:
$$
X \in \rbrack -\xi_p; 0 \lbrack
$$
\item Looking for $X>0$:
$$
X \in \rbrack 0; \xi_r \lbrack
$$
\end{itemize}

\subsubsection{Limited by REACTANTS only}
This is a "combination only" reaction:
\begin{itemize}
\item
$$
	\Delta_r \nu = - \Delta_r \nu^r < 0 
$$
\item $$P_i \equiv 1$$
\item $$X \in \rbrack -\infty; \xi_r \lbrack$$
\item $$F_i(\vec{C},\xi_r)=-1$$
\item Looking for $X>0$:
 $$
 \left\lbrace
 \begin{array}{rcl}
 	X &\in& \rbrack 0;\xi_r \lbrack\\
	F &\in& \rbrack F_i(\vec{C},0)>0 ; -1 \lbrack\\
\end{array}
\right.
 $$
 \item Looking for $X<0$:\\
 We use $S_i=K_i^{\frac{1}{\Delta_r \nu}}=K_i^{\frac{-1}{\Delta_r \nu^r}}$
 and look for $n$ such that:
 $$
 	\left\lbrace
 \begin{array}{rcl}
 	X &\in& \rbrack -2^n S_i;0 \lbrack\\
	F &\in& \rbrack F_i(\vec{C},-2^nS_i)>0 ; F_i(\vec{C},0)<0 \lbrack\\
\end{array}
\right.
 $$
\end{itemize}
 	
\subsubsection{Limited by PRODUCTS only}
This is a "dissociation only" reaction:
\begin{itemize}
\item
$$
	\Delta_r \nu =  \Delta_r \nu^p > 0 
$$
\item
$$
	R_i \equiv K_i
$$
\item
$$
	X \in \rbrack -\xi_p; +\infty \lbrack
$$
\item Looking for $X<0$:
$$
 \left\lbrace
 \begin{array}{rcl}
 	X &\in& \rbrack -\xi_p; 0 \lbrack\\
	F &\in& \rbrack K_i; F_i(\vec{C},0)<0 \lbrack\\
\end{array}
\right.
$$
\item Looking for $X>0$:\\
 We use $S_i=K_i^{\frac{1}{\Delta_r \nu}}=K_i^{\frac{1}{\Delta_r \nu^p}}$
 and look for $n$ such that:
 $$
 	\left\lbrace
 \begin{array}{rcl}
 	X &\in& \rbrack 0; 2^n S_i\lbrack\\
	F &\in& \rbrack F_i(\vec{C},0)>0; F_i(\vec{C},2^nS_i)<0 \lbrack\\
\end{array}
\right.
 $$

\end{itemize}

\subsection{Scaling and Objective Concentration}

\begin{itemize}
\item For an {\bf active} equilibrium, there exists a unique resting extent $\xi_i^\star$ and a resting concentration $\vec{C}_i^\star$ such that:
\begin{equation}
\left\lbrace
\begin{array}{rcl}
	\vec{C}_i^\star & = & \vec{C} + \xi_i^\star \vec{\bm{\nu}}^t_i\\
	\Gamma_i(\vec{C}_i^\star) & = & 0 \\
\end{array}
\right.
\end{equation}

\item In that case, we show that:
\begin{equation}
	\sigma_i = \vec{\nu}_i \cdot \vec{\Psi}_i^\star < 0
\end{equation}	
and a {\bf blocked} equilibrium is defined by $\sigma_i\geq 0$.

\item Consequently,
\begin{equation}
	\gamma_i = \dfrac{\Gamma_i}{-\sigma_i} 
\end{equation}
is a concentration.

\item \begin{equation}
\mathcal{H}(\vec{C}) = \left\lbrack\sum_{\sigma_i<0} \left(\dfrac{\Gamma_i}{-\sigma_i}\right)^2 \right\rbrack^{\frac{1}{2}}
\end{equation}

 
\end{itemize}
 
\section{Global Solving}

\subsection{Building Lattice}

\begin{itemize}
\item
Let us take one of the $N(N-1)/2$ possibilities such that $(i<j) \in \lbrack1:N\rbrack^2$.
For all species $A_k$ which is common to both $(E_i)$ and $(E_j)$, we try to build a
new equilibrium with coefficients $\kappa_{i,k}\not=0$ and $\kappa_{j,k}\not=0$ which removes the
dependencies on $A_k$, with an index $l_{i,j,k}$:
\begin{equation}
	\kappa_{i,k} (E_i) + \kappa_{j,k} (E_j) : K'_{i,j,k} = K_i^{\kappa_{i,k}} \times K_j^{\kappa_{j,k}}
\end{equation}

\item We hence form the lattice of $L \geq N$ singles and couples in $\mathcal{E}'$
\end{itemize}


\subsection{Building Disjointed Groups}
\begin{itemize}
\item
We form all the possible groups of disjointed equilibria: two equilibria are disjointed if they share no common species.
We hence form all the groups with one up to any possible combination.

\item Using this properties, we can process simultaneously all the equilibria within one group.

\subsection{Dominant Step Algorithm}

\begin{itemize}
\item For all single equilibrium $(E_i)$, compute $\xi_i^\star$, $\vec{C}_i^\star$, $\vec{\Psi}_i^\star$, and $\sigma_i$. After
this step, is it possible to compute any relative $\mathcal{H}$.
\item For all equilibria in $\mathcal{E}'$, update if necessary $\vec{C}_i^\star$ then deduce $\vec{C}_i^\circ$ the
line optimisation of $\mathcal{H}(\vec{C})$ to $\mathcal{H}(\vec{C}_i^\star)$.
\item Find the group achieving the smallest  $\mathcal{H}(\vec{C}_{mix})$
\end{itemize}



\end{itemize} 
 
 
\section{Local Solving}

Let us start from $\vec{C}$, and we now every $\xi_i^\star$ for each $\Gamma_i$.
We want to solve
\begin{equation}
\forall i, \;\; \Gamma_i\left(\vec{C} + \sum_j \xi_j \vec{\nu}^t_j\right) =  0
\end{equation}

\begin{equation}
\left\lbrace
\begin{array}{rcl}
\Gamma_i\left(\vec{C} + \sum_j \xi_j \vec{\nu}^t_j\right) & = &  \displaystyle \Gamma_i\left(\vec{C} + \xi_i \vec{\nu}_i^t + \sum_{j\not=i} \xi_j \vec{\nu}^t_j\right)\\
\\
& = & \displaystyle\Gamma_i\left(\vec{C} + \xi_i^\star \vec{\nu}_i^t + (\xi_i-\xi_i^\star) \vec{\nu}_i^t + \sum_{j\not=i} \xi_j \vec{\nu}^t_j\right)\\
\\
& \simeq & \displaystyle (\xi_i-\xi_i^\star) \langle \vec{\Psi_i}^\star \vert \vec{\nu}_i \rangle  + \sum_{j\not=i} \langle \vec{\Psi_i} \vert \vec{\nu}_j  \rangle \xi_j\\
\end{array}
\right.
\end{equation}




\end{document}



 