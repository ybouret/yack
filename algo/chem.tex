\documentclass[aps,12pt]{revtex4}
\usepackage[a4paper]{geometry}
\usepackage{graphicx}
\usepackage{amssymb,amsfonts,amsmath,amsthm}
\usepackage{bm}
\usepackage{pslatex}
\usepackage{mathptmx}
\usepackage{bookman}
\usepackage{chemarr}

 	 
\begin{document}

\section{Notations}

Let $A_1,\ldots,A_M$ be $M$ species involved in $N$ equilibria:
\begin{equation}
	\forall i\in[1:N], \; \sum_j \nu_{i,j} A_j = 0
\end{equation}
and
\begin{equation}
	\forall i\in[1:N], \; 
	\Gamma_i = K_i \prod_{j=1}^{M} [A_j]^{\nu^r_{ij}} 
	- \prod_{j=1}^{M} [A_j]^{\nu^p_{ij}} = 0
\end{equation}

\begin{itemize}
\item $\Gamma_i$ has the sign of $\Delta_r G_i$.
\item The unit of $\Gamma_i$ is $C_0^{\sum_j \nu^p_{ij} }$
\item The unit of $K_i$ is $C_0^{\Delta_r \nu}$
\end{itemize}


\section{Derivatives}
We express the derivative of a product w.r.t. one term:
\begin{equation}
	\partial_{A_k} \left( \prod_{j=1}^{M} [A_j]^{\nu_{j}} \right)  =
	\nu_k [A_k]^{\nu_k-1} \left( \prod_{j=1,j\not=k}^{M} [A_j]^{\nu_{j}} \right)
\end{equation}

Then:
\begin{equation}
	\partial^2_{A_k, A_k} \left( \prod_{j=1}^{M} [A_j]^{\nu_{j}} \right)  =
	\nu_k (\nu_k-1) [A_k]^{\nu_k-2} \left( \prod_{j=1,j\not=k}^{M} [A_j]^{\nu_{j}} \right)
\end{equation}
and:
\begin{equation}
	\partial^2_{A_k\not=A_l} \left( \prod_{j=1}^{M} [A_j]^{\nu_{j}} \right)  =
	\nu_k [A_k]^{\nu_k-1} \nu_l [A_l]^{\nu_l-1}\left( \prod_{j=1,j\not=k,j\not=l}^{M} [A_j]^{\nu_{j}} \right)
\end{equation}

\begin{equation}
	\vec{\Psi}_i = \partial_{\vec{C}} \Gamma_i
\end{equation}

%\section{Subtracting Equation}
%
%Let $\vec{V}_1\not=\vec{0}$ and $\vec{V}_2\not=\vec{0}$.
%The smallest weighted difference is:
%\begin{equation}
%	\delta \vec{V} = \dfrac{1}{\left(\vec{V}_1+\vec{V}_2\right)^2} \left[ 
%	\langle \vec{V}_2 | \vec{V}_1+\vec{V}_2 \rangle \vec{V}_1 - \langle \vec{V}_1 | \vec{V}_1+\vec{V}_2 \rangle \vec{V}_2
%	\right]
%\end{equation}

\section{1D-Solving}

\subsection{Equation}
Let us take $\Gamma_i$ (with a least a product or a reactant).
Then there exist a unique $\Xi_i$ for which:
\begin{equation}
\left\lbrace
\begin{array}{rcl}
	\Gamma_i(\vec{C} + \Xi_i \vec{\nu}_i ) & = & 0\\
	 \Xi_i \times \Gamma_i(\vec{C}) &\geq  &0\\
\end{array}
\right.
\end{equation}
 
Indeed, $\Xi_i$ is solution of:
\begin{equation}
	 F_i(\vec{C},X) =  K_i \prod_{j=1}^{M} \left([A_j] - X \nu^r_{ij}\right)^{\nu^r_{ij}} 
	- \prod_{j=1}^{M} \left([A_j] + X \nu^p_{ij} \right)^{\nu^p_{ij}} = 0
\end{equation} 

And each $\Xi_i$ respects all the limiting extents.

\subsection{Where to look for}
Let us set:
\begin{equation}
\left\lbrace
\begin{array}{rcll}
	P_i(\vec{C},X) & = & \displaystyle \prod_{j=1}^{M} \left([A_j] + X \nu^p_{ij} \right)^{\nu^p_{ij}}, & \partial_X P_i(\vec{C},X) \geq 0 \\
	\\
	R_i(\vec{C},X) & = & \displaystyle K_i \prod_{j=1}^{M} \left([A_j] - X \nu^r_{ij}\right)^{\nu^r_{ij}}, & \partial_X R_i(\vec{C},X) \leq 0 \\
	\\
	 F_i(\vec{C},X) & = & R_i(\vec{C},X)  - P_i(\vec{C},X), & \partial_X F_i(\vec{C},X) < 0\\
\end{array}
\right.
\end{equation}

Let
\begin{equation}
	s_i = \mathrm{sign}\lbrack F_i(\vec{C},0) \rbrack
\end{equation}

\begin{itemize}
\item If $s_i=0$ then $X=0$ is solution at $\vec{C}$...

\item If $s_i>0$, then we look for $X>0$

\item If $s_i<0$, then we look for $X<0$

\end{itemize}

\subsection{Looking for $X\not=0$}
	
\subsubsection{Limited by BOTH}

\begin{itemize}
\item Looking for $X<0$:
$$
X \in \rbrack -\xi_p; 0 \lbrack
$$
\item Looking for $X>0$:
$$
X \in \rbrack 0; \xi_r \lbrack
$$
\end{itemize}

\subsubsection{Limited by REACTANTS only}
This is a "combination only" reaction:
\begin{itemize}
\item
$$
	\Delta_r \nu = - \Delta_r \nu^r < 0 
$$
\item $$P_i \equiv 1$$
\item $$X \in \rbrack -\infty; \xi_r \lbrack$$
\item $$F_i(\vec{C},\xi_r)=-1$$
\item Looking for $X>0$:
 $$
 \left\lbrace
 \begin{array}{rcl}
 	X &\in& \rbrack 0;\xi_r \lbrack\\
	F &\in& \rbrack F_i(\vec{C},0)>0 ; -1 \lbrack\\
\end{array}
\right.
 $$
 \item Looking for $X<0$:\\
 We use $S_i=K_i^{\frac{1}{\Delta_r \nu}}=K_i^{\frac{-1}{\Delta_r \nu^r}}$
 and look for $n$ such that:
 $$
 	\left\lbrace
 \begin{array}{rcl}
 	X &\in& \rbrack -2^n S_i;0 \lbrack\\
	F &\in& \rbrack F_i(\vec{C},-2^nS_i)>0 ; F_i(\vec{C},0)<0 \lbrack\\
\end{array}
\right.
 $$
\end{itemize}
 	
\subsubsection{Limited by PRODUCTS only}
This is a "dissociation only" reaction:
\begin{itemize}
\item
$$
	\Delta_r \nu =  \Delta_r \nu^p > 0 
$$
\item
$$
	R_i \equiv K_i
$$
\item
$$
	X \in \rbrack -\xi_p; +\infty \lbrack
$$
\item Looking for $X<0$:
$$
 \left\lbrace
 \begin{array}{rcl}
 	X &\in& \rbrack -\xi_p; 0 \lbrack\\
	F &\in& \rbrack K_i; F_i(\vec{C},0)<0 \lbrack\\
\end{array}
\right.
$$
\item Looking for $X>0$:\\
 We use $S_i=K_i^{\frac{1}{\Delta_r \nu}}=K_i^{\frac{1}{\Delta_r \nu^p}}$
 and look for $n$ such that:
 $$
 	\left\lbrace
 \begin{array}{rcl}
 	X &\in& \rbrack 0; 2^n S_i\lbrack\\
	F &\in& \rbrack F_i(\vec{C},0)>0; F_i(\vec{C},2^nS_i)<0 \lbrack\\
\end{array}
\right.
 $$



\end{itemize}
	
	
\section{Multiple Solving}

\subsection{Extension in 1D}

\begin{equation}
	\Gamma_i\left(\vec{C}+\xi_i \vec{\nu}_i + \sum_{j\not=i} \xi_j \vec{\nu_j}\right)
\end{equation}	

\begin{equation}
	\Gamma_i\left(\vec{C}+\xi_i \vec{\nu}_i\right) 
	\simeq 
	\underbrace{\langle \vec{\nu}_i \vert \vec{\Psi}_i' \rangle}_{\sigma_i<0} (\xi_i-\Xi_i) + A_i   (\xi_i-\Xi_i)^2
\end{equation}

\begin{equation}
	\Gamma_i = -\sigma_i \Xi_i + A_i \Xi_i^2
\end{equation}

\begin{equation}
	\Gamma_i \Xi_i \geq 0 \Rightarrow -\sigma_i \Xi_i^2 + A_i \Xi_i^3 \geq 0 \Rightarrow A_i \Xi_i - \sigma_i \geq 0
\end{equation}

We want to solve a "small" $\vec{\xi}$:
\begin{equation}
	(1-\alpha_i) \Gamma_i = A_i(\xi_i-\Xi_i)^2 + \sigma_i(\xi_i-\Xi_i) + 
	\underbrace{\sum_{j\not=i} \langle \vec{\nu}_j \vert \vec{\Psi}_i' \rangle \xi_j}_{\lambda_i}
\end{equation}

\begin{equation}
\Gamma_i - \alpha_i \Gamma_i = A_i \xi_i^2 - 2 A_i \xi_i \Xi_i  + A_i \Xi_i^2 + \sigma_i \xi_i -\sigma_i \Xi_i + \lambda_i
\end{equation}

\begin{equation}
	A_i \xi_i^2 + \underbrace{(\sigma_i - 2A_i \Xi_i )}_{B_i} \xi_i + \underbrace{\lambda_i + \alpha_i \Gamma_i}_{C_i} = 0
\end{equation}

\begin{equation}
\begin{array}{rcl}
	\Delta_i &=& B_i^2 - 4A_iC_i\\
	 & = & \sigma_i^2 - 4 A_i \sigma_i \Xi_i + 4 A_i^2 \Xi_i^2 - 4 A_i \lambda_i - 4 \alpha_i A_i \Gamma_i \\
	 & = & \sigma_i^2 - 4 A_i \left[ \lambda_i + \Xi_i (1-\alpha_i)\left(\sigma_i - A_i\Xi \right) \right]\\
	 & = & \sigma_i^2 + 4 A_i \left[ (1-\alpha_i) \Gamma_i - \lambda_i \right]\\
\end{array}
\end{equation}

\begin{equation}
	\xi_i^+ = \dfrac{ -B_i + \sqrt{\Delta_i}} {2A_i} 
	= \dfrac{\Delta_i - B_i^2}{2A_i\left[ B_i + \sqrt{\Delta_i}\right]}
	= \dfrac{-2C_i}{\left[ B_i + \sqrt{\Delta_i}\right]}
\end{equation}

\begin{equation}
	\xi_i^- = \dfrac{ -B_i - \sqrt{\Delta_i}} {2A_i} 
	= \dfrac{B_i^2 - \Delta_i }{2A_i\left[ B_i - \sqrt{\Delta_i}\right]}
	= \dfrac{2C_i}{\left[ B_i - \sqrt{\Delta_i}\right]}
\end{equation}

\end{document}

\begin{itemize}


\item Otherwise, we compute the limits of $F_i$.
	
	\begin{itemize}
	%%%%%%%%
	\item If $F_i$ is limited by none, then the equilibrium is \textbf{invalid}.

	%%%%%%%%
	\item If $F_i$ is limited by a reactant, meaning a "combination only" equilibrium:
		\begin{equation}
		\left\lbrace
			\begin{array}{rcl}
			P_i   & \equiv & 1\\
			X     & \in & \rbrack-\infty;\xi_r\lbrack\\
			R_i(\vec{C},\xi_r)  & = & 0 \\
 			F_i(\vec{C},\xi_r)  & = & -1 \\
			\end{array}
		\right.
		\end{equation}
		\begin{itemize}
			\item if $\sigma_i>0$, then we have $X\in\rbrack 0;\xi_r \lbrack$
			\item if $\sigma_i<0$, then we must find $\xi_0<0$ such that $F_i(\vec{C},\xi_0)>0$,
			then $X\in\rbrack \xi_0;0\lbrack$.
			We can start from $\xi_0 \approx -  K_i^{\frac{1}{\Delta_r \nu}}$ and decrease it until a total positive mass action is found.
		\end{itemize}
		
 	%%%%%%%%
 	\item If $F_i$ is limited by a product, meaning a "dissociation only" equilibrium:
	\begin{equation}
		\left\lbrace
			\begin{array}{rcl}
			R_i   & \equiv & K_i\\
			X     & \in & \rbrack \xi_p<0 ; +\infty \lbrack\\
			P_i(\vec{C},\xi_p)  & = & 0 \\
 			F_i(\vec{C},\xi_p)  & = & K_i \\
			\end{array}
		\right.
		\end{equation}

	
    	\begin{itemize}
    	\item if $\sigma_i<0$, then we must have $X\in\rbrack \xi_p;0\lbrack$.
    	\item if $\sigma_i>0$, then we must find $\xi_0>0$ such that $F_i(\vec{C},\xi_0)<0$,
    		then $X\in\rbrack 0; \xi_0 \lbrack$.
    		We can start from $\xi_0 \approx K_i^{\frac{1}{\Delta_r \nu}}$ and increase it until a total negative mass action is found.
    	\end{itemize}

	%%%%%%%%
	\item If $F_i$ is limited by both a product and a reactant, then $$X\in\rbrack \xi_p < 0 ; \xi_r > 0 \lbrack$$
	and depending on $\sigma_i$, the proper interval is chosen.
	\end{itemize}
	
\end{itemize}

\section{ND-Solution} 	

\subsection{Expansion}

\begin{equation}
	\Gamma_i\left(\vec{C} + \xi_i \vec{\nu}_i + \sum_{j\not=i} \xi_j \vec{\nu}_j \right) 
	\simeq 
	\Gamma_i(\vec{C} + \xi_i \vec{\nu}_i) + \sum_{j\not=i} \xi_j \langle \vec{\nu}_j \vert \vec{\psi_i} \rangle
\end{equation}

\begin{equation}
	\Gamma_i(\ldots) \simeq \underbrace{\langle \vec{\nu}_i \vert \vec{\Psi'}_i\rangle}_{\sigma_i<0} \left(\xi_i - \Xi_i\right)\left[ 1 + A_i \left(\xi_i - \Xi_i\right)\right] + \sum_{j\not=i} \xi_j \langle \vec{\nu}_j \vert \vec{\psi_i} \rangle
\end{equation}

\begin{equation}
	\dfrac{\Gamma_i(\ldots)}{\sigma_i} \simeq (\xi_i - \Xi_i) + A_i (\xi_i - \Xi_i)^2 + \sum_{j\not=i} \xi_j \dfrac{\langle \vec{\nu}_j \vert \vec{\psi_i} \rangle}{\sigma_i}
\end{equation}

\begin{equation}
	\dfrac{\Gamma_i}{\sigma_i} = -\Xi_i \left[ 1 - A_i \Xi_i \right] = A_i\Xi_i^2 - \Xi_i
\end{equation}

Remark: $-\sigma_i>0$, $\Gamma_i$ and $\Xi_i$ have the same sign, so
\begin{equation}
	1-A_i\Xi_i \geq 0
\end{equation}

\begin{equation}
\dfrac{\Gamma_i(\ldots)}{\sigma_i}   \simeq  \xi_i (1-2A_i\Xi_i) - \Xi_i + A_i (\xi_i^2 + \Xi_i^2) + \sum_{j\not=i} \xi_j \dfrac{\langle \vec{\nu}_j \vert \vec{\psi_i} \rangle}{\sigma_i}
\end{equation}

\subsection{Decrease}
We want:
\begin{equation}
\begin{array}{rcl}
	(1-\alpha_i) \dfrac{\Gamma_i}{\sigma_i} & = & (1-\alpha_i) \left( A_i\Xi_i^2 - \Xi_i\right) \\
	& = & \displaystyle \xi_i (1-2A_i\Xi_i) - \Xi_i + A_i (\xi_i^2 + \Xi_i^2) + \sum_{j\not=i} \xi_j \dfrac{\langle \vec{\nu}_j \vert \vec{\psi_i} \rangle}{\sigma_i}\\
\end{array}
\end{equation}

So: 
\begin{equation}
	\alpha_i\left( \Xi_i - A_i \Xi_i^2 \right) = \xi_i (1-2A_i\Xi_i) + A_i \xi_i^2 +
	\underbrace{\sum_{j\not=i} \xi_j \dfrac{\langle \vec{\nu}_j \vert \vec{\psi_i} \rangle}{\sigma_i}}_{L_i}
\end{equation}

\begin{itemize}
\item If $\forall i, \alpha_i=0$ (no decrease), we get $\forall i, \xi_i=0$
\item If $\alpha_i=1$ and $\xi_{j\not=i}=0$ (single decrease), $\xi_i=\Xi_i,\;xi_{j\not=i}=0$
\end{itemize}

\begin{equation}
A_i \xi_i^2 + \xi_i \underbrace{(1-2A_i\Xi_i)}_{B_i} + \underbrace{L_i - \alpha_i\left( \Xi_i - A_i \Xi_i^2 \right)}_{C_i} = 0
\end{equation}

\begin{equation}
\begin{array}{rcl}
	\Delta_i & = & (1-2A_i\Xi_i)^2 - 4 A_i \left[ L_i - \alpha_i\left( \Xi_i - A_i \Xi_i^2 \right)\right]\\
	  & = & 1 -4 A_i \left[L_i + (1-\alpha_i) \Xi_i\right] + 4 A_i^2 (1-\alpha_i) \Xi_i^2 \\
\end{array}
\end{equation}

\begin{equation}
	\xi_i^+ = \dfrac{-2C_i}{\sqrt{\Delta_i}+B_i}, \;\; \xi_i^- = \dfrac{2C_i}{\sqrt{\Delta_i}-B_i}
\end{equation}

We define:
\begin{equation}
	\rho_i = \dfrac{B_i + \sqrt{\Delta_i} }{2}-1
\end{equation}

\begin{equation}
	\underbrace{\xi_i + L_i}_{\langle\vec{\Omega}_i \vert \vec{\xi} \rangle} + \rho_i \xi_i =  \alpha_i \underbrace{\left[\Xi_i \underbrace{\left(1-A_i\Xi_i\right)}_{\geq0}\right]}_{-\Gamma_i/\sigma_i}
\end{equation}


\end{document}
