\documentclass[aps,12pt]{revtex4}
\usepackage[a4paper]{geometry}
\usepackage{graphicx}
\usepackage{amssymb,amsfonts,amsmath,amsthm}
\usepackage{bm}
\usepackage{pslatex}
\usepackage{mathptmx}
\usepackage{bookman}
\usepackage{chemarr}

 	 
\begin{document}

\section{Notations}

Let $A_1,\ldots,A_M$ be $M$ species involved in $N$ equilibria:
\begin{equation}
	\forall i\in[1:N], \; \sum_j \nu_{i,j} A_j = 0
\end{equation}
and
\begin{equation}
	\forall i\in[1:N], \; 
	\Gamma_i = K_i \prod_{j=1}^{M} [A_j]^{\nu^r_{ij}} 
	- \prod_{j=1}^{M} [A_j]^{\nu^p_{ij}} = 0
\end{equation}

\begin{itemize}
\item $\Gamma_i$ has the sign of $\Delta_r G_i$.
\item The unit of $\Gamma_i$ is $C_0^{\sum_j \nu^p_{ij} }$
\item The unit of $K_i$ is $C_0^{\Delta_r \nu}$
\end{itemize}


\section{Derivatives}
We express the derivative of a product w.r.t. one term:
\begin{equation}
	\partial_{A_k} \left( \prod_{j=1}^{M} [A_j]^{\nu_{j}} \right)  =
	\nu_k [A_k]^{\nu_k-1} \left( \prod_{j=1,j\not=k}^{M} [A_j]^{\nu_{j}} \right)
\end{equation}

Then:
\begin{equation}
	\partial^2_{A_k, A_k} \left( \prod_{j=1}^{M} [A_j]^{\nu_{j}} \right)  =
	\nu_k (\nu_k-1) [A_k]^{\nu_k-2} \left( \prod_{j=1,j\not=k}^{M} [A_j]^{\nu_{j}} \right)
\end{equation}
and:
\begin{equation}
	\partial^2_{A_k\not=A_l} \left( \prod_{j=1}^{M} [A_j]^{\nu_{j}} \right)  =
	\nu_k [A_k]^{\nu_k-1} \nu_l [A_l]^{\nu_l-1}\left( \prod_{j=1,j\not=k,j\not=l}^{M} [A_j]^{\nu_{j}} \right)
\end{equation}

\begin{equation}
	\vec{\Psi}_i = \partial_{\vec{C}} \Gamma_i
\end{equation}

%\section{Subtracting Equation}
%
%Let $\vec{V}_1\not=\vec{0}$ and $\vec{V}_2\not=\vec{0}$.
%The smallest weighted difference is:
%\begin{equation}
%	\delta \vec{V} = \dfrac{1}{\left(\vec{V}_1+\vec{V}_2\right)^2} \left[ 
%	\langle \vec{V}_2 | \vec{V}_1+\vec{V}_2 \rangle \vec{V}_1 - \langle \vec{V}_1 | \vec{V}_1+\vec{V}_2 \rangle \vec{V}_2
%	\right]
%\end{equation}

\section{1D-Solving}

\subsection{Solution}

Let us take $\Gamma_i$ (with a least a product or a reactant).
Then there exist a unique $\Xi_i$ for which:
\begin{equation}
\left\lbrace
\begin{array}{rcl}
	\Gamma_i(\vec{C} + \Xi_i \vec{\nu}_i ) & = & 0\\
	 \Xi_i \times \Gamma_i(\vec{C}) &\geq  &0\\
\end{array}
\right.
\end{equation}
 
Indeed, $\Xi_i$ is solution of:
\begin{equation}
	 F_i(\vec{C},X) =  K_i \prod_{j=1}^{M} \left([A_j] - X \nu^r_{ij}\right)^{\nu^r_{ij}} 
	- \prod_{j=1}^{M} \left([A_j] + X \nu^p_{ij} \right)^{\nu^p_{ij}} = 0
\end{equation} 

And each $\Xi_i$ respects all the limiting extents.


Let us set:
\begin{equation}
\left\lbrace
\begin{array}{rcll}
	P_i(\vec{C},X) & = & \displaystyle \prod_{j=1}^{M} \left([A_j] + X \nu^p_{ij} \right)^{\nu^p_{ij}}, & \partial_X P_i(\vec{C},X) > 0 \\
	\\
	R_i(\vec{C},X) & = & \displaystyle K_i \prod_{j=1}^{M} \left([A_j] - X \nu^r_{ij}\right)^{\nu^r_{ij}}, & \partial_X R_i(\vec{C},X) < 0 \\
	\\
	 F_i(\vec{C},X) & = & R_i(\vec{C},X)  - P_i(\vec{C},X), & \partial_X F_i(\vec{C},X) < 0\\
\end{array}
\right.
\end{equation}

Let
\begin{equation}
	\sigma_i = \mathrm{sign}\lbrack P_i(\vec{C},0) \rbrack
\end{equation}

\begin{itemize}

\item If $\sigma_i=0$ then $X=0$ is solution at $\vec{C}$...

\item Otherwise, we compute the limits of $F_i$.
	
	\begin{itemize}
	%%%%%%%%
	\item If $F_i$ is limited by none, then the equilibrium is \textbf{invalid}.

	%%%%%%%%
	\item If $F_i$ is limited by a reactant, meaning a "combination only" equilibrium:
		\begin{equation}
		\left\lbrace
			\begin{array}{rcl}
			P_i   & \equiv & 1\\
			X     & \in & \rbrack-\infty;\xi_r\lbrack\\
			R_i(\vec{C},\xi_r)  & = & 0 \\
 			F_i(\vec{C},\xi_r)  & = & -1 \\
			\end{array}
		\right.
		\end{equation}
		\begin{itemize}
			\item if $\sigma_i>0$, then we have $X\in\rbrack 0;\xi_r \lbrack$
			\item if $\sigma_i<0$, then we must find $\xi_0<0$ such that $F_i(\vec{C},\xi_0)>0$,
			then $X\in\rbrack \xi_0;0\lbrack$.
			We can start from $\xi_0 \approx -  K_i^{\frac{1}{\Delta_r \nu}}$ and decrease it until a total positive mass action is found.
		\end{itemize}
		
 	%%%%%%%%
 	\item If $F_i$ is limited by a product, meaning a "dissociation only" equilibrium:
	\begin{equation}
		\left\lbrace
			\begin{array}{rcl}
			R_i   & \equiv & K_i\\
			X     & \in & \rbrack \xi_p<0 ; +\infty \lbrack\\
			P_i(\vec{C},\xi_p)  & = & 0 \\
 			F_i(\vec{C},\xi_p)  & = & K_i \\
			\end{array}
		\right.
		\end{equation}

	
    	\begin{itemize}
    	\item if $\sigma_i<0$, then we must have $X\in\rbrack \xi_p;0\lbrack$.
    	\item if $\sigma_i>0$, then we must find $\xi_0>0$ such that $F_i(\vec{C},\xi_0)<0$,
    		then $X\in\rbrack 0; \xi_0 \lbrack$.
    		We can start from $\xi_0 \approx K_i^{\frac{1}{\Delta_r \nu}}$ and increase it until a total negative mass action is found.
    	\end{itemize}

	%%%%%%%%
	\item If $F_i$ is limited by both a product and a reactant, then $$X\in\rbrack \xi_p < 0 ; \xi_r > 0 \lbrack$$
	\end{itemize}
	
\end{itemize}



 \subsection{Regularization}
We define:
\begin{equation}
\vec{\Psi}_i = \partial_{\vec{C}} \Gamma_i.
\end{equation}
If $|\vec{\Psi}_i|=0$, then we solve $\Gamma_i$. If we still have $|\vec{\Psi}_i|=0$, we declare $\Gamma_i$ blocked.

\subsection{Evolution}

We start from a regularized $\vec{C}$ and some possibly blocked equilibria. We 
want to solve:
\begin{equation}
	\vec{0} = 	\vec{\Gamma}(\vec{C}+\bm{\nu}^T \vec{\xi}) \simeq \vec{\Gamma} + \bm{\Psi} \bm{\nu}^T \vec{\xi}
\end{equation}

\begin{equation}
	\bm{\Omega} = \bm{\Psi} \bm{\nu}^T
\end{equation}	

For a regularized equilibrium, $\Omega_{ii}=\langle \vec{\Psi}_i \vert \vec{\nu}_i \rangle < 0$ is
a scaling factor for $\Gamma_i$, and
\begin{equation}
	\left\vert \dfrac{\Gamma_i}{\langle \vec{\Psi}_i \vert \vec{\nu}_i \rangle} \right\vert
\end{equation}
is homogenous to a concentration.\\
We first estimate:
\begin{equation}
	\vec{\xi} =  {\bm{\Omega}}^{-1} \cdot (-\vec{\Gamma} )
\end{equation}

\subsection{Method}

If we start from $\vec{C}$, we can compute $\vec{\Xi}$ such that:
\begin{equation}
	\forall i, \;\; \Gamma_i(\vec{C}_i') = 0, \;\; \vec{C}_i' = \vec{C} + \Xi_i \vec{\nu}_i
\end{equation}

Let us know evaluate $\delta\Xi_i$ for a small change $\delta\vec{C}$:
\begin{equation}
	\forall i, \;\;  \Gamma_i(\vec{C}_i' + \delta\vec{C} + \delta\Xi_i \vec{\nu}_i) = 0 \Rightarrow 
	\langle \vec{\Psi}_i' \vert \delta\vec{C} +  \delta\Xi_i \vec{\nu}_i \rangle \simeq 0 
\end{equation}
so:
\begin{equation}
	\forall i, \;\; \delta\Xi_i \langle \vec{\Psi}_i' \vert \vec{\nu}_i \rangle
	 = -  \langle\vec{\Psi}_i' \vert \delta\vec{C} \rangle
\end{equation}
  	

\subsection{Method again}

\begin{equation}
	\partial_t \vec{\xi} = k\vec{\Xi}(\vec{C})
\end{equation}
Implicit:
\begin{equation}
	\vec{\xi} = \tau \vec{\Xi}(\vec{C}+\bm{\nu}^T \vec{\xi} ) 
	\simeq \tau \left[ \vec{\Xi}(\vec{C}) + \partial_{\vec{C}}\vec{\Xi} \, \bm{\nu}^T \vec{\xi} \right]
\end{equation}
and:
\begin{equation}
	\vec{\xi} = \tau \left[ \bm{I}_N - \tau \, \partial_{\vec{C}}\vec{\Xi} \, \bm{\nu}^T \right]^{-1} \vec{\Xi}(\vec{C}) 
\end{equation}

\begin{equation}
	- \partial_{\vec{C}}\vec{\Xi} \, \bm{\nu}^T = 
	\begin{bmatrix}
		 \dfrac{\langle \vec{\Psi}_i' \vert \vec{\nu}_j \rangle}{\langle \vec{\Psi}_i' \vert \vec{\nu}_i \rangle} 	
	\end{bmatrix}
	 = \bm{\Omega}
\end{equation}



 

\end{document}