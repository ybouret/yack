\documentclass[aps,12pt]{revtex4}
\usepackage[a4paper]{geometry}
\usepackage{graphicx}
\usepackage{amssymb,amsfonts,amsmath,amsthm}
\usepackage{bm}
\usepackage{pslatex}
\usepackage{mathptmx}
\usepackage{bookman}
\usepackage{chemarr}
\usepackage{tikz}

%\newcommand*\circled[1]{\tikz[baseline=(char.base)]{ \node[shape=circle,draw,inner sep=2pt] (char) {#1};}}
 	 
\begin{document}
\section{Notation}

\subsection{Species}
Let $A_1,\dots,A_M$ be $M$ species composing a chemical system
with their respective concentrations $[A_1],\ldots,[A_M]$.
We define a phase state vector:
\begin{equation}
	\vec{C} = 
	\begin{bmatrix}
	[A_1]\\
	\vdots\\
	[A_M]\\
	\end{bmatrix}
	\in \mathbb{R}^M
\end{equation}

\subsection{Equilibrium}
\subsubsection{Definition}
Let $E_i$ be an equilibrium defined with integer coefficient $\nu_{i,j}$:
\begin{equation}
	(E_i) :  \sum_{j=1}^M \nu_{i,j} A_j = 0
\end{equation}
We define the positive constant of $(E_i)$ as $K_i$ and the
equilibrium condition is described by $\Gamma_i$ and the partition
of the coefficients:
\begin{equation}
	\Gamma_i(\vec{C}) = K_i \prod_{j=1}^{M} [A_j]^{\nu^r_{ij}} 
	- \prod_{j=1}^{M} [A_j]^{\nu^p_{ij}} = 0
\end{equation}
We define:
\begin{equation}
	\vec{\bm{\nu}}^t_i = 
	\begin{bmatrix}
	\nu_{i,1}\\
	\vdots\\
	\nu_{i,M}\\
	\end{bmatrix}
\end{equation}

\subsubsection{Gradient}

We express the derivative of a product w.r.t. one term:
\begin{equation}
	\partial_{A_k} \left( \prod_{j=1}^{M} [A_j]^{\nu_{j}} \right)  =
	\nu_k [A_k]^{\nu_k-1} \left( \prod_{j=1,j\not=k}^{M} [A_j]^{\nu_{j}} \right)
\end{equation}
 
\begin{equation}
	\vec{\Psi}_i = \partial_{\vec{C}} \Gamma_i
\end{equation}


\subsection{Equilibria}
Let $\mathcal{E}$ be a set of $N$ independent equilibria $(E_1),\dots,(E_N)$.
We define the equilibrium vector:
\begin{equation}
	\vec{\Gamma}(\vec{C}) =
	\begin{bmatrix}
	\Gamma_1(\vec{C})\\
	\vdots\\
	\Gamma_N(\vec{C})\\
	\end{bmatrix}
	\in \mathbb{R}^N
\end{equation}

We define the topology matrix:
\begin{equation}
	\bm{\nu} = 
	\begin{bmatrix}
	\vec{\nu}_1\\
	\vdots\\
	\vec{\nu}_N\\
	\end{bmatrix}
	\in \mathbb{M}_{N,M}
	= \lbrack \nu_{i,j} \rbrack
\end{equation}


We define the Jacobian matrix:
\begin{equation}
\bm{\Psi} = \partial_{\vec{C}} \vec{\Gamma} = 
\begin{bmatrix}
	\vec{\Psi}_1\\
	\vdots\\
	\vec{\Psi}_N\\
	\end{bmatrix}
	\in \mathbb{M}_{N,M} = 
	\lbrack \partial_{A_j}\Gamma_i \rbrack
\end{equation}

\section{Manifold}
\subsection{Purpose}
Initially, we are given of set of $N$ independent equilibria $\mathcal{E}$:
\begin{equation}
	\mathrm{rank}(\bm{\nu}) = \mathrm{rank}(\bm{\nu}^t) = N
\end{equation}
We want to build a manifold of equilibria by finding
all the combinations that make one or more species disappear from
the result: this is how two species can interact directly by
the internal exchange of the removed species.
\subsection{Look Up}
Let us a species $A_j$. Its coefficients across the
primary system are
\begin{equation}
	\vec{w}_j = \vec{\bm{\nu}^t_{j}}
\end{equation}

If the count of non-zero coefficients in  $\vec{w}_j$ if greater than one,
then there is at least one possibility to find a vector $\vec{\alpha}$ \emph{with matching coefficients} such
that:

\begin{equation}
	\vec{\alpha}.\vec{w}_j=0 \Leftrightarrow \vec{\alpha} \in \vec{w}_j^\perp
\end{equation}

\section{Conservation}

%Let $\bm{P}$ be a the $\bm{\nu}$.

A conservation law $\vec{\alpha}\in\mathbb{R}_+^{*M}$ is such that:
\begin{equation}
	\forall \vec{\xi} \in \mathbb{R}^N, \;\; \langle \vec{\alpha} \vert \bm{\nu}^t \vec{\xi} \rangle = 0
\end{equation}

To find such a condition, we form the matrix $\bm{P}$ with is $\bm{\nu}$ from which we removed the species
which cannot be conserved, and from which we removed the line of the non-conservative equilibria, 
such that $\bm{P}$ is left with $N'$ independent rows.
\begin{equation}
\left \lbrace
\begin{array}{rcl}
\delta\vec{C} & = & \bm{P}^t\vec{u} + \bm{P}_\perp^t \vec{v} \\
\bm{P}       & \in & \mathcal{M}_{N',M}\\
\vec{u}      & \in & \mathbb{R}^{N'}\\
\bm{P}_\perp & \in & \mathcal{M}_{M-N',M}\\
\vec{v}      & \in & \mathbb{R}^{M-N'}     \\
\end{array}
\right .
\end{equation}

If it exists, then $\vec{\alpha}$ must be in the span of $\bm{P}_\perp^t$, namely $\mathrm{Im}\left(\bm{P}_\perp^t\right)$.

\begin{equation}
	\bm{P} \delta \vec{C} = \bm{P}\bm{P}^t\vec{u}
	 \Rightarrow \vec{u} = \left(\bm{P}\bm{P}^t\right)^{-1} \bm{P} \delta \vec{C}
\end{equation}

\begin{equation}
	\delta\vec{C} =  \bm{P}^t\left(\bm{P}\bm{P}^t\right)^{-1} \bm{P} \delta \vec{C} + \bm{P}_\perp^t \vec{v}\\
\end{equation}
	
\begin{equation}
	\bm{P}_\perp^t \vec{v} = 
	\underbrace{\left\lbrack \bm{I}_M - \bm{P}^t\left(\bm{P}\bm{P}^t\right)^{-1} \bm{P} \right\rbrack}_{\bm{Q}^t} \delta\vec{C}
\end{equation}

\begin{equation}
	\mathrm{Im}\left(\bm{P}_\perp^t\right) = \mathrm{Im}\left(\bm{\tilde Q}^t\right) \text{ and }
	\mathrm{rank}(\bm{P}_\perp) = \mathrm{rank}(\bm{\tilde Q})
\end{equation}

Consequently, if it existe, any vector $\vec{\alpha}$ is a combination of the rows of $\bm{\tilde Q}$.
Since $\bm{\nu}$ has its coefficients in $\mathbb{N}$ of $\mathbb{Q}$, we simplify each row of 
$\bm{\tilde Q}$ into a row of proportional integers to form the simplified matrix $\bm{Q}$.


\section{Solving ONE Equilibrium}

\subsection{Equation}
Let us take $\Gamma_i$.
Then there exist a unique $\xi_i^\star$ for which:
\begin{equation}
\left\lbrace
\begin{array}{rcl}
	\Gamma_i(\vec{C} + \xi_i^\star \vec{\nu}_i ) & = & 0\\
	 \xi_i^\star \times \Gamma_i(\vec{C}) &\geq  &0\\
\end{array}
\right.
\end{equation}
 
Indeed, $\xi_i^\star$ is solution of:
\begin{equation}
	 F_i(\vec{C},X) =  K_i \prod_{j=1}^{M} \left([A_j] - X \nu^r_{ij}\right)^{\nu^r_{ij}} 
	- \prod_{j=1}^{M} \left([A_j] + X \nu^p_{ij} \right)^{\nu^p_{ij}} = 0
\end{equation} 

And each $\xi_i^\star$ respects all the limiting extents.

\subsection{Where to look for}
Let us set:
\begin{equation}
\left\lbrace
\begin{array}{rcll}
	P_i(\vec{C},X) & = & \displaystyle \prod_{j=1}^{M} \left([A_j] + X \nu^p_{ij} \right)^{\nu^p_{ij}}, & \partial_X P_i(\vec{C},X) \geq 0 \\
	\\
	R_i(\vec{C},X) & = & \displaystyle K_i \prod_{j=1}^{M} \left([A_j] - X \nu^r_{ij}\right)^{\nu^r_{ij}}, & \partial_X R_i(\vec{C},X) \leq 0 \\
	\\
	 F_i(\vec{C},X) & = & R_i(\vec{C},X)  - P_i(\vec{C},X), & \partial_X F_i(\vec{C},X) < 0\\
\end{array}
\right.
\end{equation}

Let
\begin{equation}
	s_i = \mathrm{sign}\lbrack F_i(\vec{C},0) \rbrack
\end{equation}

\begin{itemize}
\item If $s_i=0$ then $X=0$ is solution at $\vec{C}$...

\item If $s_i>0$, then we look for $X>0$

\item If $s_i<0$, then we look for $X<0$

\end{itemize}

\subsection{Looking for $X\not=0$}
	
\subsubsection{Limited by BOTH}

\begin{itemize}
\item Looking for $X<0$:
$$
X \in \rbrack -\xi_p; 0 \lbrack
$$
\item Looking for $X>0$:
$$
X \in \rbrack 0; \xi_r \lbrack
$$
\end{itemize}

\subsubsection{Limited by REACTANTS only}
This is a "combination only" reaction:
\begin{itemize}
\item
$$
	\Delta_r \nu = - \Delta_r \nu^r < 0 
$$
\item $$P_i \equiv 1$$
\item $$X \in \rbrack -\infty; \xi_r \lbrack$$
\item $$F_i(\vec{C},\xi_r)=-1$$
\item Looking for $X>0$:
 $$
 \left\lbrace
 \begin{array}{rcl}
 	X &\in& \rbrack 0;\xi_r \lbrack\\
	F &\in& \rbrack F_i(\vec{C},0)>0 ; -1 \lbrack\\
\end{array}
\right.
 $$
 \item Looking for $X<0$:\\
 We use $S_i=K_i^{\frac{1}{\Delta_r \nu}}=K_i^{\frac{-1}{\Delta_r \nu^r}}$
 and look for $n$ such that:
 $$
 	\left\lbrace
 \begin{array}{rcl}
 	X &\in& \rbrack -2^n S_i;0 \lbrack\\
	F &\in& \rbrack F_i(\vec{C},-2^nS_i)>0 ; F_i(\vec{C},0)<0 \lbrack\\
\end{array}
\right.
 $$
\end{itemize}
 	
\subsubsection{Limited by PRODUCTS only}
This is a "dissociation only" reaction:
\begin{itemize}
\item
$$
	\Delta_r \nu =  \Delta_r \nu^p > 0 
$$
\item
$$
	R_i \equiv K_i
$$
\item
$$
	X \in \rbrack -\xi_p; +\infty \lbrack
$$
\item Looking for $X<0$:
$$
 \left\lbrace
 \begin{array}{rcl}
 	X &\in& \rbrack -\xi_p; 0 \lbrack\\
	F &\in& \rbrack K_i; F_i(\vec{C},0)<0 \lbrack\\
\end{array}
\right.
$$
\item Looking for $X>0$:\\
 We use $S_i=K_i^{\frac{1}{\Delta_r \nu}}=K_i^{\frac{1}{\Delta_r \nu^p}}$
 and look for $n$ such that:
 $$
 	\left\lbrace
 \begin{array}{rcl}
 	X &\in& \rbrack 0; 2^n S_i\lbrack\\
	F &\in& \rbrack F_i(\vec{C},0)>0; F_i(\vec{C},2^nS_i)<0 \lbrack\\
\end{array}
\right.
 $$

\end{itemize}

\subsection{Scaling and Objective Concentration}

\begin{itemize}
\item For an {\bf active} equilibrium, there exists a unique resting extent $\xi_i^\star$ and a resting concentration $\vec{C}_i^\star$ such that:
\begin{equation}
\left\lbrace
\begin{array}{rcl}
	\vec{C}_i^\star & = & \vec{C} + \xi_i^\star \vec{\bm{\nu}}^t_i\\
	\Gamma_i(\vec{C}_i^\star) & = & 0 \\
\end{array}
\right.
\end{equation}

\item In that case, we show that:
\begin{equation}
	\sigma_i = \vec{\nu}_i \cdot \vec{\Psi}_i^\star < 0
\end{equation}	
and a {\bf blocked} equilibrium is defined by $\sigma_i\geq 0$.

\item Consequently,
\begin{equation}
	\gamma_i = \dfrac{\Gamma_i}{-\sigma_i} 
\end{equation}
is a concentration.

\item \begin{equation}
\mathcal{H}(\vec{C}) = \left\lbrack\sum_{\sigma_i<0} \left(\dfrac{\Gamma_i}{-\sigma_i}\right)^2 \right\rbrack^{\frac{1}{2}}
\end{equation}

 
\end{itemize}
 
 
 
\section{Local Solving}

Let us start from $\vec{C}$, and we now every $\xi_i^\star$ for each $\Gamma_i$.
We want to solve
\begin{equation}
\forall i, \;\; \Gamma_i\left(\vec{C} + \sum_j \xi_j \vec{\nu}^t_j\right) =  0
\end{equation}

The function:
\begin{equation}
\left\lbrace
\begin{array}{rcl}
	\Gamma_i \left(\vec{C} +  \xi_i \vec{\nu}^t_i\right) & = &
	 g_i(\xi_i) + 
	 \left(\xi_i - \xi_i^\star\right) 	\langle \vec{\Psi_i}^\star \vert \vec{\nu}^t_i \rangle\\
	 g_i(0)            & = & \Gamma_i - \xi_i^\star \langle \vec{\Psi_i}^\star \vert \vec{\nu}^t_i \rangle \;\;\; \text{(sign of $\Gamma_i$ is sign of $\xi_i^\star$)}\\
	 g_i(\xi_i^\star)  & = & 0\\
	 g'_i(0)           & = & \underbrace{\langle \vec{\Psi_i} \vert \vec{\nu}^t_i \rangle}_{\Gamma'_i\leq0} - \underbrace{\langle \vec{\Psi_i}^\star \vert \vec{\nu}^t_i \rangle}_{<0} 
	 = - \langle \delta\vec{\Psi}_i \vert \vec{\nu}^t_i \rangle\\
	 g'_i(\xi_i^\star) & = & 0\\
	 \end{array}
\right.
\end{equation}

\begin{equation}
	\Gamma_i \left(\vec{C} +  \xi_i \vec{\nu}^t_i  + \sum_{j\not=i} \xi_j \vec{\nu}^t_j \right) 
	\simeq g_i(\xi_i) + \left(\xi_i - \xi_i^\star\right)
	\langle \vec{\Psi_i}^\star \vert \vec{\nu}^t_i \rangle + \sum_{j\not=i} \xi_j \langle \vec{\Psi}_{\xi_i}  \vert \vec{\nu}^t_j \rangle
\end{equation} 	

\begin{equation}
	\vec{\Psi}_{\xi_i} \simeq \vec{\Psi}_i + \xi_i \vec{\Theta}_i,\;\;
	\vec{\Theta}_i = \dfrac{1}{\xi_i^\star}\left(\vec{\Psi}_i^\star-\vec{\Psi}_i\right)
	= \dfrac{1}{\xi_i^\star} \delta\vec{\Psi}_i
\end{equation}

\end{document}



 